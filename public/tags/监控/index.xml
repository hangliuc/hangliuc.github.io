<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>监控 on hangliuc</title>
        <link>http://localhost:1313/tags/%E7%9B%91%E6%8E%A7/</link>
        <description>Recent content in 监控 on hangliuc</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>Example Person</copyright>
        <lastBuildDate>Fri, 05 Dec 2025 13:38:56 +0800</lastBuildDate><atom:link href="http://localhost:1313/tags/%E7%9B%91%E6%8E%A7/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Monitoring</title>
        <link>http://localhost:1313/topic/interview/monitoring/</link>
        <pubDate>Fri, 05 Dec 2025 13:38:56 +0800</pubDate>
        
        <guid>http://localhost:1313/topic/interview/monitoring/</guid>
        <description>&lt;img src="http://localhost:1313/img/interview_cover.jpg" alt="Featured image of post Monitoring" /&gt;&lt;h2 id=&#34;1监控指标类型及应用场景&#34;&gt;1.监控指标类型及应用场景
&lt;/h2&gt;&lt;p&gt;1、 计数器（Counter）：用于记录事件的数量，例如请求次数、错误次数等。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特点：单调递增，只增不减，重启时被设置为0&lt;/li&gt;
&lt;li&gt;场景：qps、error、已经完成的任务数等&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2、 计量器（Gauge）：用于记录当前的数值，例如内存使用量、CPU 利用率等。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特点：可增可减，可以任意变化的指标&lt;/li&gt;
&lt;li&gt;场景：cpu、mem、disk、network等&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Histogram和Summary主用用于计算分位数，统计和分析样本的分布情况。&lt;/p&gt;
&lt;p&gt;3、 直方图（Histogram）：用于记录事件的分布情况，Prometheus 服务端通过 bucket 计算分位数。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特点：要提前定义 bucket（如 10ms、50ms、100ms…），用于将样本值分桶。可以聚合跨实例的全局分位数（Summary 做不到）&lt;/li&gt;
&lt;li&gt;场景：业务接口延迟监控，p95、p99&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;histogram_quantile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;99&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http_request_duration_seconds_bucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;le&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;4、 摘要（Summary）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;特点：不需要 bucket，代码内自动维护 quantile。无法跨实例计算全局 p99
如果你有 10 个 pod，各自暴露 p99，那么 Prometheus 不能再算“整个服务的 p99”&lt;/li&gt;
&lt;li&gt;场景：每个实例都独立的统计需求&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Summary 的分位数是在客户端（应用）本地计算的，Prometheus 只需存储最终的 p95、p99 数值。但是不能聚合跨实例的全局分位数。
Histogram在服务端计算分位数，Histogram 能够将多个实例的数据聚合在一起，得出整个服务的全局分位数，是k8s生产环境最常用的方式。&lt;/p&gt;
&lt;h2 id=&#34;2-黄金指标&#34;&gt;2. 黄金指标
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;延迟（Latency）&lt;/li&gt;
&lt;li&gt;qps&lt;/li&gt;
&lt;li&gt;错误率（Error Rate）&lt;/li&gt;
&lt;li&gt;饱和度（Saturation）&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        
    </channel>
</rss>
